box:
  id: dceoy/wercker-base
  entrypoint: /bin/bash -c
build:
  steps:
    - script:
        name: Prepare required packages
        code: |
          apt-get -y update
          apt-get -y install r-base-dev libcurl4-gnutls-dev libssl-dev git
    - script:
        name: Install clir
        code: |
          curl https://raw.githubusercontent.com/dceoy/clir/master/install.sh | bash
    - script:
        name: Set environment variables
        code: |
          chsh -s /bin/bash root
          echo 'export PATH="${HOME}/.clir/bin:${PATH}"' >> ~/.bash_profile
          echo 'export R_LIBS="${HOME}/.clir/r/library"' >> ~/.bash_profile
          source ~/.bash_profile
    - script:
        name: Test clir
        code: |
          clir install foreach lintr
          clir validate devtools drat foreach lintr yaml
  after-steps:
    - slack-notifier:
        url: $SLACK_URL
        channel: $SLACK_CHANNEL
